var yoxviewApi;
(function(w){var x;w.yoxviewUnload=function(){if(yoxviewApi){yoxviewApi.unload();yoxviewApi=null}};w(window).unload(function(){w.yoxviewUnload()});w.fn.extend({yoxview:function(U){if(this.length==0)return this;x||(x=typeof _yoxviewPath!="undefined"?_yoxviewPath:Yox.getPath(/(.*)jquery.yoxview.*/i));this.loadLanguage=function(r,V){var F=this;if(yoxviewLanguages[r])Yox.loadDataSource(y,V,F);else{yoxviewLanguages[r]={};w.ajax({url:x+"lang/"+r+".js",async:false,dataType:"json",success:function(qa){yoxviewLanguages[r]=qa;
Yox.loadDataSource(y,V,F)}})}};var y=w.extend({autoHideInfo:true,autoPlay:false,backgroundColor:"#000",backgroundOpacity:0.8,buttonsFadeTime:300,cacheBuffer:5,cacheImagesInBackground:true,controlsInitialFadeTime:1500,controlsInitialDisplayTime:1E3,dataFolder:x+"data/",imagesFolder:x+"images/",infoBackColor:"Black",infoBackOpacity:0.5,isRTL:false,lang:"en",langFolder:x+"lang/",loopPlay:true,playDelay:3E3,popupMargin:20,popupResizeTime:600,renderButtons:true,renderMenu:true,showBarsOnOpen:true,showButtonsOnOpen:true,
titleAttribute:"title",titleDisplayDuration:2E3},U);yoxviewApi?this.loadLanguage(y.lang,function(r){yoxviewApi.AddViews(r,y)}):this.loadLanguage(y.lang,function(r){yoxviewApi=new YoxView(r,y)});return this}})})(jQuery);var yoxviewLanguages=[];
function YoxView(w,x){function U(a){a=d(a).data("yoxview");if(!v||ra!=a.viewIndex){v=a.images;k=v.length;ra=a.viewIndex;var c=false;if(a.options&&!Yox.compare(b,a.options)){b=a.options;c=true}else if(!a.options&&!Yox.compare(b,sa)){b=sa;c=true}else if(L&&k==1||i&&!L&&k>0)c=true;if(c){if(i){z.remove();A=B=W=G=fa=L=i=undefined;X=p=0;g.infoButtons=undefined}ta()}}}function y(a,c,e){a=d(a);a.data("yoxview",{viewIndex:c});if(!Yox.compare(b,e))a.data("yoxview").options=e;e.isSingleLink=a[0].tagName=="A";
var f=[];(e.isSingleLink?a:a.find("a:has(img)")).each(function(h,m){var j;a:{j=d(m);var s=false,C={},D=j.attr("href"),M=j.children("img:first");if(D.match(Yox.imageRegex))d.extend(C,{media:{src:j.attr("href"),title:M.attr(b.titleAttribute),alt:M.attr("alt")}});else{for(videoProvider in Yox.videoRegex)if(D.match(Yox.videoRegex[videoProvider])){d.extend(C,{media:{type:"video",provider:videoProvider,url:D}});s=true;break}if(!s){j=null;break a}}d.extend(C,{thumbnailImg:M,thumbnailSrc:M.attr("src")});
j=C}j!=null&&f.push(j)});if(e.images)f=f.concat(e.images);if(e.dataSource)Yox.dataSources[e.dataSource].getImagesData(e,function(h){f=f.concat(h.images);a.data("yoxview").images=f;var m=h.isGroup?[d.extend(h,{media:{title:h.title+" ("+h.images.length+" images)",alt:h.title}})]:h.images;r(a,e.isSingleLink?null:m,!h.createGroups?null:function(j){var s=d(j.currentTarget).data("yoxview"),C=d(j.currentTarget);j=C.data("yoxthumbs");if(s.imagesAreSet)g.openGallery(s.viewIndex);else{C.css("cursor","wait");
var D=d.extend({},b);if(D.dataSourceOptions)d.extend(D.dataSourceOptions,j);else D.dataSourceOptions=j;Yox.dataSources[b.dataSource].getImagesData(D,function(M){s.images=M.images;s.imagesAreSet=true;C.css("cursor","");g.openGallery(s.viewIndex)})}});e.isSingleLink||d.each(a.yoxthumbs("thumbnails"),function(j,s){s.data("yoxview",{viewIndex:H.length});H.push(s)});if(!g.firstViewWithImages&&h.images.length>0){g.firstViewWithImages=a;e.cacheImagesInBackground&&g.startCache()}});else{a.data("yoxview").images=
f;r(a)}}function r(a,c,e){a.yoxthumbs({images:c,enableOnlyMedia:true,onClick:e||function(f){f.preventDefault();b.thumbnailsOptions&&b.thumbnailsOptions.onClick?b.thumbnailsOptions.onClick(d(f.currentTarget).data("yoxthumbs").imageIndex,d(f.currentTarget),d(f.liveFired).data("yoxview").viewIndex):g.openGallery(d(f.liveFired||f.currentTarget).data("yoxview").viewIndex,d(f.currentTarget).data("yoxthumbs").imageIndex);return false}})}function V(a){var c=d(H[ra]);N=c[0].tagName=="A"?c:c.yoxthumbs("thumbnails")[p];
if(!N||N.length==0)N=c.yoxthumbs("thumbnails")[0];if(c=N.children("img:first")){a&&G&&G.attr("src",c.attr("src"));ua=c.offset();o={width:c.width(),height:c.height(),top:ua.top-d(window).scrollTop(),left:ua.left}}}function F(a){a.stop().fadeIn(b.buttonsFadeTime,function(){d(this).delay(500).fadeOut(b.buttonsFadeTime)})}function qa(a){d(a).stop().animate({opacity:0.5},b.buttonsFadeTime)}function va(a,c,e){var f=d("<a>",{href:"#",click:function(){return g.clickBtn(g[c],e)}});d("<span>"+a+"</span>").css("opacity",
"0").appendTo(f);f.append(I.getSprite("icons",c));return f}function Ga(a,c){var e=new Image;e.src=b.imagesFolder+c+".png";e=d("<a>",{css:{background:"url("+e.src+") no-repeat "+c+" center",opacity:"0",outline:"0"},className:"yoxview_ctlBtn",href:"#",click:function(){this.blur();return g.clickBtn(a,true)}});e.css(c,"0");return e}function ta(){n=yoxviewLanguages[b.lang];z=d("<div>",{id:"yoxview_popupWrap",css:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"none","z-index":"100"}});
i=d("<div>",{id:"yoxview"});z.appendTo(d(parent.document.body)).append(i);B=d("<div>",{className:"yoxview_imgPanel",css:{"z-index":"2"}});A=d("<div>",{className:"yoxview_imgPanel",css:{"z-index":"1",display:"none"}});G=d("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}});W=d("<img />",{className:"yoxview_fadeImg",css:{display:"block",width:"100%",height:"100%"}});B.data("yoxviewPanel",{image:G}).append(G).appendTo(i);A.data("yoxviewPanel",{image:W});A.append(W).appendTo(i);
var a=k==1;if(a&&!v[0].media[b.titleAttribute])b.renderInfo=false;if(b.renderMenu!==false){var c=d("<div>",{className:"yoxview_popupBarPanel yoxview_top"});b.autoHideMenu!==false&&c.mouseenter(function(){g.isOpen&&Ha()}).mouseleave(function(){g.isOpen&&wa()});E=d("<div>",{id:"yoxview_menuPanel",css:{opacity:"0.8","background-position":I.getBackgroundPosition("menu","back")}});var e=va(n.Help,"help",false),f=va(n.Slideshow,"play",false);xa=f.children("span");E.append(va(n.Close,"close",true),e,f);
if(a){f.css("display","none");e.css("display","none");E.css({width:58})}E.find("a:last-child").attr("class","last");c.append(E).appendTo(i);E.delegate("a","mouseenter",function(){d(this).stop().animate({top:"8px"},"fast").find("span").stop().animate({opacity:1},"fast")}).delegate("a","mouseleave",function(){d(this).stop().animate({top:"0"},"fast").find("span").stop().animate({opacity:0},"fast")})}if(b.renderButtons!==false&&!a){L=Ga(g.prev,b.isRTL?"right":"left");L.appendTo(i);fa=Ga(g.next,b.isRTL?
"left":"right");fa.appendTo(i)}O=i.find(".yoxview_ctlBtn");ga=d("<div>",{id:"yoxview_ajaxLoader",className:"yoxview_notification",css:{display:"none"}});ga.append(d("<img>",{src:b.imagesFolder+"popup_ajax_loader.gif",alt:n.Loading,css:{width:32,height:32,"background-image":"url("+b.imagesFolder+"sprites.png)","background-position":I.getBackgroundPosition("notifications","empty")}})).appendTo(i);jQuery.each(["play","pause","first","last"],function(h,m){var j=I.getSprite("notifications",m);j.attr("className",
"yoxview_notification").css("display","none").appendTo(i);Y[m]=j});J=d("<div>",{id:"yoxview_helpPanel",href:"#",title:n.CloseHelp,css:{background:"url("+b.imagesFolder+"help_panel.png) no-repeat center top",direction:n.Direction,opacity:"0"},click:function(){return g.clickBtn(g.help,false)}});c=document.createElement("h1");c.innerHTML=n.Help.toUpperCase();e=document.createElement("p");e.innerHTML=n.HelpText;f=document.createElement("span");f.id="yoxview_closeHelp";f.innerHTML=n.CloseHelp;J.append(c).append(e).append(f).appendTo(i);
if(b.renderInfo!==false){P=d("<div>",{className:"yoxview_popupBarPanel yoxview_bottom"});P.mouseenter(function(){g.isOpen&&!Z&&b.autoHideInfo!==false&&ha()}).mouseleave(function(){g.isOpen&&!Z&&b.autoHideInfo!==false&&$()});q=d("<div>",{id:"yoxview_infoPanel"});q.append(d("<div>",{id:"yoxview_infoPanelBack",css:{background:b.infoBackColor,opacity:b.infoBackOpacity}}));K=d("<div>",{id:"yoxview_infoPanelContent"});ia=d("<span>",{id:"yoxview_count"});Q=d("<div>",{id:"yoxview_infoText"});if(a){Q.css("margin-left",
"10px");ia.css("display","none")}K.append(ia);if(b.renderInfoPin!==false){ya=I.getSprite("icons",b.autoHideInfo?"pin":"unpin");Ia=d("<a>",{className:"yoxviewInfoLink",href:"#",title:b.autoHideInfo?n.PinInfo:n.UnpinInfo,css:{display:"inline"},click:function(h){h.preventDefault();b.autoHideInfo=!b.autoHideInfo;ya.css("background-position",I.getBackgroundPosition("icons",b.autoHideInfo?"pin":"unpin"));this.title=b.autoHideInfo?n.PinInfo:n.UnpinInfo}});Ia.append(ya).appendTo(K)}if(b.linkToOriginalContext!==
false){aa=d("<a>",{className:"yoxviewInfoLink",target:"_blank",title:n.OriginalContext});aa.append(I.getSprite("icons","link")).appendTo(K)}if(b.infoButtons){g.infoButtons=b.infoButtons;for(infoButton in b.infoButtons)b.infoButtons[infoButton].attr("className","yoxviewInfoLink").css("display","inline").appendTo(K)}K.append(Q);q.append(K).appendTo(P);i.append(P)}Ja=d("<div>",{css:{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",background:b.backgroundColor,"z-index":"1",opacity:b.backgroundOpacity},
click:function(){return g.clickBtn(g.close,true)}}).appendTo(z);b.buttonsFadeTime!=0&&O.hover(function(){g.isOpen&&d(this).stop().animate({opacity:0.6},b.buttonsFadeTime)},function(){d(this).stop().animate({opacity:0},b.buttonsFadeTime)})}function za(){Ka++;if(Ka==k)Aa=true;Aa||La()}function La(){if(!b.cacheBuffer||X!=R)ba(X+(ca?1:-1))}function Ba(){if(b.cacheBuffer){R=ca?p+b.cacheBuffer:p-b.cacheBuffer;if(R<0)R+=k;else if(R>=k)R-=k}}function ba(a){if(!Aa){if(a==k)a=0;else if(a<0)a+=k;var c=v[a].media;
X=a;if(c&&!c.loaded)if(!c.type||c.type==="image")Ma.src=c.src;else Na(c,function(){za()});else La()}}function Oa(){Ca=true;ga.stop().stopTime().oneTime(b.buttonsFadeTime,function(){d(this).stop().css("opacity","0.6").fadeIn(b.buttonsFadeTime)})}function Da(a,c,e,f,h){i.stop().animate({width:a,height:c,top:e,left:f},b.popupResizeTime,h)}function ja(){if(k!=1){t=true;if(p<k-1)i.oneTime(b.playDelay,"play",function(){g.next()});else b.loopPlay?i.oneTime(b.playDelay,"play",function(){g.select(0,null)}):
S()}}function S(){i.stopTime("play");t=false}function Pa(){var a=d(parent.window).width(),c=d(parent.window).height();return{height:c,width:a,usableHeight:c-b.popupMargin*2,usableWidth:a-b.popupMargin*2}}function ha(a){clearTimeout(da);var c=Q.outerHeight();if(c<Qa)c=Qa;q.stop().animate({height:c},500,function(){a&&a()})}function $(a){clearTimeout(da);q.stop().animate({height:0},500,function(){a&&a()})}function wa(a){clearTimeout(Ea);E.stop().animate({top:Sa},500,function(){a&&a()})}function Ha(a){clearTimeout(Ea);
E.stop().animate({top:0},500,function(){a&&a()})}function ka(a){var c,e=!a.type||a.type==="image";e&&Z&&q&&P.css("display","block");clearTimeout(da);if(B.css("z-index")==1){l=B;c=G;la=A}else{l=A;c=W;la=B}l.data("maxSize",{width:a.width,height:a.height});var f=Yox.fitImageSize(a,{width:u.usableWidth,height:u.usableHeight});if(q){var h=a.title||"";if(a.description)h+=h!=""?"<div id='yoxview_infoTextDescription'>"+a.description+"</div>":a.description;Q.html(h);k>1&&ia.html(p+1+"/"+k);if(aa)g.currentImage.link?
aa.attr("href",g.currentImage.link).css("display","inline"):aa.css("display","none")}h=l.data("yoxviewPanel");if(e){c.attr({src:a.src,title:a.title,alt:a.alt});O.css({height:"100%",width:"50%",top:"0"});if(l.isMedia){h.media.remove();h.media=undefined;h.image.show();l.isMedia=false}Z=false}else{if(h.media)h.media.show();else{h.media=d("<div>",{className:"yoxview_mediaPanel"});h.image.hide();l.append(h.media)}h.media.html(a.html);O.css({width:ma.width,height:ma.height,top:f.height/2-ma.height/2});
if(!l.isMedia){h.image.hide();l.isMedia=true}if(q){b.autoHideInfo!==false&&$();P.css("display","none");Z=true}}na?l.animate({width:f.width,height:f.height},b.popupResizeTime):l.css({width:f.width+"px",height:f.height+"px"});a=Math.round((u.height-f.height)/2);c=Math.round((u.width-f.width)/2);if(Ca){Ca=false;ga.stop().stopTime().fadeOut(b.buttonsFadeTime)}T=true;Da(f.width,f.height,a,c,function(){if(na){g.isOpen=true;if(b.controlsInitialDisplayTime>0){b.showButtonsOnOpen&&O.animate({opacity:0.5},
b.controlsInitialFadeTime,function(){b.buttonsFadeTime!=0&&d(this).delay(b.controlsInitialDisplayTime).animate({opacity:0},b.controlsInitialFadeTime)});if(b.showBarsOnOpen){Ha(function(){if(b.autoHideMenu!==false)Ea=setTimeout(function(){wa()},b.controlsInitialDisplayTime)});q&&ha(function(){if(b.autoHideInfo!==false)da=setTimeout(function(){$()},b.controlsInitialDisplayTime)})}}b.autoPlay&&g.play();b.onOpen&&b.onOpen();if(oa){oa();oa=undefined}na=false}T=false});l.css({"z-index":"2",opacity:1});
la.css("z-index","1");l.fadeIn(b.popupResizeTime,function(){la.css("display","none");q&&ha(function(){if(b.autoHideInfo!==false)da=setTimeout(function(){$()},b.titleDisplayDuration)});if(k>1){p<k-1&&b.cacheImagesInBackground&&ba(p+1);t&&ja()}})}function Ta(a,c,e,f,h){jQuery.jsonp({url:Ua[a]||"http://oohembed.com/oohembed/",data:jQuery.extend({url:c,format:"json"},e),dataType:"jsonp",callbackParameter:"callback",success:function(m){var j={title:m.title,width:m.width,height:m.height,type:m.type};if(m.type===
"video")j.html=m.html.replace(/<embed /,'<embed wmode="transparent" ').replace(/<param/,'<param name="wmode" value="transparent"><param').replace(/width=\"[\d]+\"/ig,'width="100%"').replace(/height=\"[\d]+\"/ig,'height="100%"');else m.type==="photo"&&jQuery.extend(j,{src:m.url,alt:m.title,type:"image"});f(j)},error:function(m,j){h&&h(m,j)}})}function Ra(a){try{if(!a)throw"Error: Media is unavailable.";if(!a.type||a.type==="image"){if(d.support.opacity)Fa.src="";Fa.src=a.src}else a.loaded?ka(g.currentImage.media):
Na(a,function(e){ka(e)},function(e){pa("Error getting data from:<br /><span class='errorUrl'>"+e.data.url+"</span>")})}catch(c){pa(c)}}function Na(a,c,e){if(!a.type||a.type!=="image")Ta(a.provider,a.url,b.videoSize,function(f){d.extend(a,f,{loaded:true});c&&c(a)},e)}function pa(a){ka({html:"<span class='yoxview_error'>"+a+"</span>",width:500,height:300,type:"error",title:""})}var g=this,d=jQuery,ga,R,Aa=false,Ka=0,ca=true,Ma=new Image,ia,O,X=0,p=0,n={},ra=0,sa=x,Z=false,na=true,J,da,Ea,G,W,v,k=0,
q,K,aa,Qa=30,P,Ia,ya,Q,t=this.isOpen=false,T=false,Ca=false,ma={width:100,height:100},Ua={vimeo:"http://vimeo.com/api/oembed.json",myspace:"http://vids.myspace.com/index.cfm?fuseaction=oembed"},Sa=-42,E,fa,Y=[],oa,b=sa,B,A,xa,i,Ja,z,L,ea=false,Fa=new Image,N,ua,o,H=[],u,Va={40:"DOWN",35:"END",13:"ENTER",36:"HOME",37:"LEFT",39:"RIGHT",32:"SPACE",38:"UP",72:"h",27:"ESCAPE"},Wa={RIGHT:b.isRTL?"prev":"next",DOWN:"next",UP:"prev",LEFT:b.isRTL?"next":"prev",ENTER:"play",HOME:"first",END:"last",SPACE:"next",
h:"help",ESCAPE:"close"},I=new Yox.Sprites({notifications:{width:59,height:59,sprites:["empty","playRTL","play","pause","last","first"]},icons:{width:18,height:18,sprites:["close","help","play","link","pin","unpin"]},menu:{height:42,sprites:["back"]}},b.imagesFolder+"sprites.png",b.imagesFolder+"empty.gif");this.AddViews=function(a,c){var e=this.firstViewWithImages!=undefined;jQuery.each(a,function(){y(this,H.length,c);H.push(this);if(!g.firstViewWithImages){var f=d(this).data("yoxview").images;if(f&&
f.length!=0)g.firstViewWithImages=this}});if(!e&&this.firstViewWithImages){U(this.firstViewWithImages);ta();if(c.cacheImagesInBackground&&k!=0){Ba();ba(0)}e=true}};this.SetImages=function(a){k=a.length};this.openGallery=function(a,c,e){if(typeof a=="function"){e=a;a=c=0}else if(typeof c=="function"){e=c;c=0}a=a||0;c=c||0;U(H[a]);!i&&k!=0&&ta();this.selectImage(c);z.stop().css({opacity:1}).fadeIn("slow",function(){z.css("opacity","")});b.cacheImagesInBackground&&ba(c);if(e)oa=e;return false};this.selectImage=
function(a){g.currentImage=v[a];p=a;V(true);N.blur();B.css({"z-index":"1",width:o.width,height:o.height});A.css({display:"none","z-index":"2"});na=true;i.css({width:o.width,height:o.height,top:o.top,left:o.left});this.select(a)};this.refresh=function(){(ea=t)&&S();t||Oa();Ra(g.currentImage.media);ea&&ja()};this.select=function(a,c){if(typeof c==="number")c=undefined;if(!T){if(a<0)a=k-1;else if(a==k)a=0;if(!t&&c){var e=c;e.css("opacity")==0&&e.stop().animate({opacity:0},b.buttonsFadeTime,qa(e))}g.currentImage=
v[a];p=a;t||Oa();Ra(g.currentImage.media);Ba();b.onSelect&&b.onSelect(a,v[a])}};this.prev=function(){ca=false;this.select(p-1,L);return false};this.next=function(){ca=true;this.select(p+1,fa);return false};this.first=function(){F(Y.first);this.select(0);return false};this.last=function(){F(Y.last);this.select(k-1);return false};this.play=function(){if(k!=1){ca=true;if(t){F(Y.pause);S();xa.text(n.Play)}else{F(Y.play);ja();xa.text(n.Pause)}}};this.close=function(){this.closeHelp();V(false);Da(o.width,
o.height,o.top,o.left,function(){g.isOpen=false});wa();q&&$(function(){Q.html("")});l.animate({width:o.width,height:o.height},b.popupResizeTime,function(){l.css("opacity",1);Ja.css("opacity",b.backgroundOpacity)});z.stop().fadeOut(1E3);t&&S();b.onClose&&b.onClose();T=false};this.help=function(){if(this.isOpen)J.css("display")=="none"?J.css("display","block").stop().animate({opacity:0.8},b.buttonsFadeTime):this.closeHelp()};this.closeHelp=function(){J.css("display")!="none"&&J.stop().animate({opacity:0},
b.buttonsFadeTime,function(){J.css("display","none")})};this.clickBtn=function(a,c){c&&t&&S();a.call(this);return false};this.AddViews(w,b);d(document).delegate("*","keydown",function(a){if(g&&g.isOpen){var c=g[Wa[Va[a.keyCode]]];if(c){a.preventDefault();c.apply(g)}}});d(window).bind("resize.yoxview",function(){u=Pa();g.isOpen&&g.resize()});d(Ma).load(function(){d.extend(v[X].media,{width:this.width,height:this.height,loaded:true});za()}).error(function(){za()});this.startCache=function(){U(this.firstViewWithImages);
Ba();ba(0)};var l=B,la=A;u=Pa();this.resize=function(){if(t){ea=true;S()}var a=l.data("maxSize");if(a&&a){a=Yox.fitImageSize(a,{width:u.usableWidth,height:u.usableHeight});l.css({width:"100%",height:"100%"});var c=Math.round((u.height-a.height)/2),e=Math.round((u.width-a.width)/2);T=true;l.isMedia&&O.animate({top:a.height/2-ma.height/2},b.popupResizeTime);Da(a.width,a.height,c,e,function(){var f=i.width(),h=i.height();l.css({width:f+"px",height:h+"px"});T=false;q&&ha();if(ea){ja();ea=false}})}};d(Fa).load(function(){this.width==
0?pa("Image error"):ka(d.extend({},g.currentImage.media,{width:this.width,height:this.height}))}).error(function(){pa("Image not found:<br /><span class='errorUrl'>"+this.src+"</span>")});this.unload=function(){jQuery.each(H,function(a,c){d(c).undelegate("a","click.yoxview").removeData("yoxview").yoxthumbs("unload","yoxview")});d(window).unbind(".yoxview");if(i){z.remove();i=undefined}}};
